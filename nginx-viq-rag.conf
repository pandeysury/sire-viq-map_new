# Add this to your existing nginx configuration
# VIQ RAG System Configuration

# Frontend - Static files
location /viq-rag/ {
    alias /home/sheshmani/Desktop/sire-viq-map_new/frontend/;
    index index.html;
    try_files $uri $uri/ /viq-rag/index.html;
    expires 1h;
    add_header X-Frame-Options "SAMEORIGIN";
    add_header Cache-Control "public, max-age=3600";
}

location = /viq-rag {
    return 301 /viq-rag/;
}

# Backend API
location /viq-rag/api/ {
    rewrite ^/viq-rag/api/?(.*)$ /$1 break;
    proxy_pass http://127.0.0.1:8003;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_read_timeout 300;
    proxy_connect_timeout 60;
    proxy_send_timeout 60;
    
    # Handle CORS
    add_header Access-Control-Allow-Origin *;
    add_header Access-Control-Allow-Methods "GET, POST, OPTIONS";
    add_header Access-Control-Allow-Headers "Content-Type, Authorization";
    
    if ($request_method = 'OPTIONS') {
        return 204;
    }
}

# API Documentation
location /viq-rag/docs {
    proxy_pass http://127.0.0.1:8003/docs;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

# Health Check
location /viq-rag/health {
    proxy_pass http://127.0.0.1:8003/health;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}